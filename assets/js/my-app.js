/* Target Data - would love to have this in a separate file, but can't for security reasons
 * Maybe do at a later date serving from webserver */
targets = [{"Manufacturer":"Merlin","Type":"Big Game","Name":"Wildebeest (group 1)","Image":"Wildebeest.jpg","":""},{"Manufacturer":"Merlin","Type":"Spider","Name":"Tarantula (group 4)","Image":"Tarantula.jpg","":""},{"Manufacturer":"Merlin","Type":"Bird","Name":"Goose (group 3)","Image":"Goose.jpg","":""},{"Manufacturer":"Merlin","Type":"Bird","Name":"Vulture (group 3)","Image":"Vulture.jpg","":""},{"Manufacturer":"Merlin","Type":"Varmint","Name":"Armadillo (group 4)","Image":"Armadillo.jpg","":""},{"Manufacturer":"LCC","Type":"Varmint","Name":"Small Game - Capybara","Image":"Small-Game---Capybara.jpg","":""},{"Manufacturer":"LCC","Type":"Boar","Name":"Small Animal - Warthog","Image":"Small-Animal---Warthog.jpg","":""},{"Manufacturer":"LCC","Type":"Deer","Name":"Small Animal - Topi","Image":"Small-Animal---Topi.jpg","":""},{"Manufacturer":"LCC","Type":"Deer","Name":"Small Animal - Hartebeest","Image":"Small-Animal---Hartebeest.jpg","":""},{"Manufacturer":"LCC","Type":"Varmint","Name":"Small Animal - Capybara 1","Image":"Small-Animal---Capybara-1.jpg","":""},{"Manufacturer":"LCC","Type":"Varmint","Name":"Small Animal - Armadillo","Image":"Small-Animal---Armadillo.jpg","":""},{"Manufacturer":"LCC","Type":"Big Cat","Name":"Medium Game - Tiger","Image":"Medium-Game---Tiger.jpg","":""},{"Manufacturer":"LCC","Type":"Big Game","Name":"Medium Game - Impala","Image":"Medium-Game---Impala.jpg","":""},{"Manufacturer":"LCC","Type":"Reptile","Name":"Medium Game - Crocodile","Image":"Medium-Game---Crocodile.jpg","":""},{"Manufacturer":"LCC","Type":"Big Game","Name":"Large Game - Zebra","Image":"Large-Game---Zebra.jpg","":""},{"Manufacturer":"LCC","Type":"Big Cat","Name":"Large Game - Lion","Image":"Large-Game---Lion.jpg","":""},{"Manufacturer":"LCC","Type":"Big Game","Name":"Large Animal - Rhino","Image":"Large-Animal---Rhino.jpg","":""},{"Manufacturer":"LCC","Type":"Big Game","Name":"Large Animal - Buffalo","Image":"Large-Animal---Buffalo.jpg","":""},{"Manufacturer":"JVD","Type":"Varmint","Name":"Squirrel - 80201","Image":"Squirrel---80201.jpg","":""},{"Manufacturer":"JVD","Type":"Bear","Name":"Bear - 80341","Image":"Bear---80341.jpg","":""},{"Manufacturer":"JVD","Type":"Deer","Name":"Deer - 80301","Image":"Deer---80301.jpg","":""},{"Manufacturer":"JVD","Type":"Bird","Name":"Pheasant - 80271","Image":"Pheasant---80271.jpg","":""},{"Manufacturer":"JVD","Type":"Varmint","Name":"Rabbit - 80241","Image":"Rabbit---80241.jpg","":""},{"Manufacturer":"JVD","Type":"Varmint","Name":"Ermine - 80211","Image":"Ermine---80211.jpg","":""},{"Manufacturer":"JVD","Type":"Deer","Name":"Large Deer - 80351","Image":"Large-Deer---80351.jpg","":""},{"Manufacturer":"JVD","Type":"Bird","Name":"Turkey - 80311","Image":"Turkey---80311.jpg","":""},{"Manufacturer":"JVD","Type":"Bird","Name":"Blue Grouse - 80281","Image":"Blue-Grouse---80281.jpg","":""},{"Manufacturer":"JVD","Type":"Bird","Name":"Duck - 80251","Image":"Duck---80251.jpg","":""},{"Manufacturer":"JVD","Type":"Bird","Name":"Jay - 80221","Image":"Jay---80221.jpg","":""},{"Manufacturer":"JVD","Type":"Bird","Name":"Partridge - 80331","Image":"Partridge---80331.jpg","":""},{"Manufacturer":"JVD","Type":"Predator","Name":"Fox - 80291","Image":"Fox---80291.jpg","":""},{"Manufacturer":"JVD","Type":"Varmint","Name":"Hare - 80261","Image":"Hare---80261.jpg","":""},{"Manufacturer":"JVD","Type":"Predator","Name":"Wolf - 80231","Image":"Wolf---80231.jpg","":""},{"Manufacturer":"Maximal","Type":"Deer","Name":"Grazing Deer","Image":"Grazing-Deer.jpg","":""},{"Manufacturer":"Maximal","Type":"Deer","Name":"Howling Deer","Image":"Howling-Deer.jpg","":""},{"Manufacturer":"Maximal","Type":"Boar","Name":"Wild Boar In Snow","Image":"Wild-Boar-In-Snow.jpg","":""},{"Manufacturer":"Maximal","Type":"Boar","Name":"Large Wild Boar","Image":"Large-Wild-Boar.jpg","":""},{"Manufacturer":"Maximal","Type":"Deer","Name":"Female Roe Deer Alert","Image":"Female-Roe-Deer-Alert.jpg","":""},{"Manufacturer":"Maximal","Type":"Deer","Name":"Roe Deer Alert","Image":"Roe-Deer-Alert.jpg","":""},{"Manufacturer":"Maximal","Type":"Deer","Name":"Medium Roe Deer","Image":"Medium-Roe-Deer.jpg","":""},{"Manufacturer":"Maximal","Type":"Boar","Name":"Medium Wild Boar","Image":"Medium-Wild-Boar.jpg","":""},{"Manufacturer":"Maximal","Type":"Bird","Name":"Mallard Duck","Image":"Mallard-Duck.jpg","":""},{"Manufacturer":"Maximal","Type":"Bird","Name":"Pheasent","Image":"Pheasent.jpg","":""},{"Manufacturer":"Maximal","Type":"Bird","Name":"Flying Falcon","Image":"Flying-Falcon.jpg","":""},{"Manufacturer":"Maximal","Type":"Bird","Name":"Canadian Goose","Image":"Canadian-Goose.jpg","":""},{"Manufacturer":"Maximal","Type":"Bird","Name":"Magpie","Image":"Magpie.jpg","":""},{"Manufacturer":"Maximal","Type":"Bird","Name":"Dove","Image":"Dove.jpg","":""},{"Manufacturer":"Maximal","Type":"Deer","Name":"Small Roe Deer","Image":"Small-Roe-Deer.jpg","":""},{"Manufacturer":"Maximal","Type":"Bird","Name":"Owl","Image":"Owl.jpg","":""},{"Manufacturer":"Maximal","Type":"Varmint","Name":"Hare Alert","Image":"Hare-Alert.jpg","":""},{"Manufacturer":"Maximal","Type":"Bird","Name":"Canadian Goose Alert","Image":"Canadian-Goose-Alert.jpg","":""},{"Manufacturer":"Maximal","Type":"Varmint","Name":"Raccoon","Image":"Raccoon.jpg","":""},{"Manufacturer":"Maximal","Type":"Predator","Name":"Fox","Image":"Fox.jpg","":""},{"Manufacturer":"Delta","Type":"Varmint","Name":"Prairie Dog/Skunk","Image":"Prairie-Dog-Skunk.jpg","":""},{"Manufacturer":"Delta","Type":"Big Game","Name":"Antelope","Image":"Antelope.jpg","":""},{"Manufacturer":"Delta","Type":"Big Game","Name":"Elk","Image":"Elk.jpg","":""},{"Manufacturer":"Delta","Type":"Predator","Name":"Fox","Image":"Fox.jpg","":""},{"Manufacturer":"Delta","Type":"Bear","Name":"Bear","Image":"Bear.jpg","":""},{"Manufacturer":"Delta","Type":"Deer","Name":"101 Whitetail Deer","Image":"101-Whitetail-Deer.jpg","":""},{"Manufacturer":"Delta","Type":"Boar","Name":"Wild Boar","Image":"Wild-Boar.jpg","":""},{"Manufacturer":"Delta","Type":"Bird","Name":"Full Strut Turkey","Image":"Full-Strut-Turkey.jpg","":""},{"Manufacturer":"Delta","Type":"Boar","Name":"Javelina","Image":"Javelina.jpg","":""},{"Manufacturer":"Delta","Type":"Goat","Name":"Bighorn Sheep","Image":"Bighorn-Sheep.jpg","":""},{"Manufacturer":"Delta","Type":"Varmint","Name":"Woodchuck/Rabbit","Image":"Woodchuck-Rabbit.jpg","":""},{"Manufacturer":"Delta","Type":"Bird","Name":"Wild Turkey","Image":"Wild-Turkey.jpg","":""},{"Manufacturer":"Delta","Type":"Deer","Name":"102 Whitetail Deer","Image":"102-Whitetail-Deer.jpg","":""},{"Manufacturer":"Delta","Type":"Predator","Name":"Coyote","Image":"Coyote.jpg","":""},{"Manufacturer":"Delta","Type":"Predator","Name":"Bobcat","Image":"Bobcat.jpg","":""},{"Manufacturer":"Delta","Type":"Predator","Name":"Cougar","Image":"Cougar.jpg","":""},{"Manufacturer":"Delta","Type":"Deer","Name":"Mule Deer","Image":"Mule-Deer.jpg","":""},{"Manufacturer":"Delta","Type":"Varmint","Name":"Raccoon","Image":"Raccoon.jpg","":""},{"Manufacturer":"Delta","Type":"Deer","Name":"203 Whitetail Deer","Image":"203-Whitetail-Deer.jpg","":""},{"Manufacturer":"Delta","Type":"Big Game","Name":"Caribou","Image":"Caribou.jpg","":""},{"Manufacturer":"Delta","Type":"Bird","Name":"Pheasent/Squirrel","Image":"Pheasent-Squirrel.jpgBjorn","":"Bjorn-Black-Bear---Group-1-Target-Face.jpg"},{"Manufacturer":"Bjorn","Type":"Bird","Name":"Black Grouse","Image":"Bjorn-Black-Grouse---Group-3-Target-Face.jpg","":""},{"Manufacturer":"Bjorn","Type":"Varmint","Name":"Martin","Image":"Bjorn-Martin---Group-4-Target-Face.jpg","":""},{"Manufacturer":"Bjorn","Type":"Bird","Name":"Pheasant","Image":"Bjorn-Pheasant---Group-4-Target-Face.jpg","":""},{"Manufacturer":"Bjorn","Type":"Varmint","Name":"Squirrel","Image":"Bjorn-Squirrel---Group-4-Target-Face.jpg","":""},{"Manufacturer":"Bjorn","Type":"Deer","Name":"Stag","Image":"Bjorn-Stag---Group-1-Target-Face.jpg","":""},{"Manufacturer":"Bjorn","Type":"Predator","Name":"Wolverine","Image":"Bjorn-Wolverine---Group-2-Target-Face.jpg","":""},{"Manufacturer":"Bjorn","Type":"Bird","Name":"Woodcock","Image":"Bjorn-Woodcock---Group-4-Target-Face.jpg","":""},{"Manufacturer":"Martin","Type":"Big Game","Name":"Antelope","Image":"Martin-Antelope-(Group-2)-Target-Face.jpg","":""},{"Manufacturer":"Martin","Type":"Deer","Name":"Broadside Deer","Image":"Martin-Broadside-Deer-(Group-2)Target-Face.jpg","":""},{"Manufacturer":"Martin","Type":"Big Game","Name":"Elk","Image":"Martin-Elk-(Group-2)-Target-Face.jpg","":""},{"Manufacturer":"Martin","Type":"Predator","Name":"Fox","Image":"Martin-Fox-(Group-3)-Target-Face.jpg","":""},{"Manufacturer":"Martin","Type":"Deer","Name":"Grazing Deer","Image":"Martin-Grazing-Deer-(Group-2)-Target-Face.jpg","":""},{"Manufacturer":"Martin","Type":"Boar","Name":"Javelina","Image":"Martin-Javelina-(Group-2)Target-Face.jpg","":""},{"Manufacturer":"Martin","Type":"Goat","Name":"Ram","Image":"Martin-Ram-(Group-1)-Target-Face.jpg","":""},{"Manufacturer":"Martin","Type":"Bird","Name":"Turkey","Image":"Martin-Turkey-(Group-3)Target-Face.jpg","":""},{"Manufacturer":"NFAA","Type":"Bear","Name":"Black Bear","Image":"NFAA-Group-1-Target-Face---Black-Bear.jpg","":""},{"Manufacturer":"NFAA","Type":"Big Game","Name":"Elk","Image":"NFAA-Group-1-Traget-Face---Elk.jpg","":""},{"Manufacturer":"NFAA","Type":"Deer","Name":"Mule Deer","Image":"NFAA-Group-1-Traget-Face---Mule-Deer.jpg","":""},{"Manufacturer":"NFAA","Type":"Predator","Name":"Mountain Lion","Image":"NFAA-Group-2-Target-Face---Mountain-Lion.jpg","":""},{"Manufacturer":"NFAA","Type":"Goat","Name":"Pronghorn Antelope","Image":"NFAA-Group-2-Target-Face---Pronghorn-Antelope.jpg","":""},{"Manufacturer":"NFAA","Type":"Deer","Name":"White Tail Deer","Image":"NFAA-Group-2-Target-Face---White-Tail-Deer.jpg","":""},{"Manufacturer":"NFAA","Type":"Predator","Name":"Wolf","Image":"NFAA-Group-2-Target-Face---Wolf.jpg","":""},{"Manufacturer":"NFAA","Type":"Bird","Name":"Canadian Goose","Image":"NFAA-Group-3-Target-Face---Canadian-Goose.jpg","":""},{"Manufacturer":"NFAA","Type":"Predator","Name":"Coyote","Image":"NFAA-Group-3-Target-Face---Coyote.jpg","":""},{"Manufacturer":"NFAA","Type":"Predator","Name":"Fox","Image":"NFAA-Group-3-Target-Face---Fox.jpg","":""},{"Manufacturer":"NFAA","Type":"Boar","Name":"Javelina","Image":"NFAA-Group-3-Target-Face---Javelina.jpg","":""},{"Manufacturer":"NFAA","Type":"Varmint","Name":"Racoon","Image":"NFAA-Group-3-Target-Face---Racoon.jpg","":""},{"Manufacturer":"NFAA","Type":"Bird","Name":"Turkey","Image":"NFAA-Group-3-Target-Face---Turkey.jpg","":""},{"Manufacturer":"NFAA","Type":"Varmint","Name":"Beaver","Image":"NFAA-Group-4-Target-Face---Beaver.jpg","":""},{"Manufacturer":"NFAA","Type":"Bird","Name":"Crow","Image":"NFAA-Group-4-Target-Face---Crow.jpg","":""},{"Manufacturer":"NFAA","Type":"Bird","Name":"Duck","Image":"NFAA-Group-4-Target-Face---Duck.jpg","":""},{"Manufacturer":"NFAA","Type":"Bird","Name":"Grouse","Image":"NFAA-Group-4-Target-Face---Grouse.jpg","":""},{"Manufacturer":"NFAA","Type":"Varmint","Name":"Jack Rabbitt","Image":"NFAA-Group-4-Target-Face---Jack-Rabbitt.jpg","":""},{"Manufacturer":"NFAA","Type":"Varmint","Name":"Prairie Dog","Image":"NFAA-Group-4-Target-Face---Prairie-Dog.jpg","":""},{"Manufacturer":"NFAA","Type":"Varmint","Name":"Squirrel","Image":"NFAA-Group-4-Target-Face---Squirrel.jpg","":""}];
/* Framework */

var app = new Framework7({
  // App root element
  root: '#app',
  // App Name
  name: '2D Reference',
  // App id
  id: 'com.myapp.test',
  
  
});

var mainView = app.views.create('.view-main');
var searchView = app.views.create('.view-search');



/* Groups of Targets */
manufacturer = [];
type = [];
manufacturers = [];
types = [];
all = [];
total_targets = 0;

var $$ = Dom7;

/* Load All the targets */

targets.forEach(function(t) {
	total_targets = total_targets + 1;
	target = {
		url: 'targets/' + t.Manufacturer + '/' + t.Image,
		caption: t.Name + ' - ' + t.Manufacturer,
		type: t.Type,
		manufacturer: t.Manufacturer,
		image: t.Image
	};
	all.push(target);
	if (typeof manufacturer[t.Manufacturer] === 'undefined') {
		manufacturer[t.Manufacturer] = [];
	}
	manufacturer[t.Manufacturer].push(target);
	
	if (typeof type[t.Type] === 'undefined') {
		type[t.Type] = [];
	}
	type[t.Type].push(target);
	
	// add to manufacturer list
	existing_manu = manufacturers.find(function(e) {
		if (e.name == t.Manufacturer) {
			return true;
		} else {
			return false;
		}
	}); 
	if (! existing_manu) {
		manufacturers.push({"name": t.Manufacturer});
	}
	
	// add to types list
	existing_type = types.find(function(e) {
		if (e.name == t.Type) {
			return true;
		} else {
			return false;
		}
	}); 
	if (! existing_type) {
		types.push({"name": t.Type});
	}
});




/*=== TEMPLATES ===*/
var manTemplate = $$('#man-template').html();
var compiledManTemplate = Template7.compile(manTemplate);

var html = compiledManTemplate({ manufacturers: manufacturers });
$$('#man-links').html(html);

var typeTemplate = $$('#type-template').html();
var compiledTypeTemplate = Template7.compile(typeTemplate);

var html = compiledTypeTemplate({ types: types });
$$('#type-links').html(html);

var allTemplate = $$('#all-template').html();
var compiledAllTemplate = Template7.compile(allTemplate);

all_sorted = all.sort(function(a,b) {return (a.caption > b.caption) ? 1 : ((b.caption > a.caption) ? -1 : 0);} );
var html = compiledAllTemplate({ all: all_sorted });
$$('#all-links').html(html);

var countTemplate = $$('#count-template').html();
var compiledCountTemplate = Template7.compile(countTemplate);

var html = compiledCountTemplate({ 'target_count': total_targets });
$$('#target-count').html(html);

/*=== Galleries ===*/
var pb = [];
var individual = [];
targets.forEach(function(t) {
	//console.log('Creating: ' + t);
	pb[t.Manufacturer] = app.photoBrowser.create({
		photos: manufacturer[t.Manufacturer],
		type: 'popup'
	});
	pb[t.Type] = app.photoBrowser.create({
		photos: type[t.Type],
		type: 'popup'
	});
	individual[t.Manufacturer + "-" + t.Image] = app.photoBrowser.create({
		photos: [
			{
				url: 'targets/' + t.Manufacturer + '/' + t.Image,
				caption: t.Name + ' - ' + t.Manufacturer
			}
		],
		type: 'popup'
	});
	
});

$$('.pb-popup-manufacturer').on('click', function (e) {
	//console.log(e.target.id);
	pb[e.target.id].open();
});

$$('.pb-popup-type').on('click', function (e) {
	//console.log(e.target.id);
	pb[e.target.id].open();
});

$$('.pb-popup-individual').on('click', function (e) {
	console.log(e.target.id);
	individual[e.target.id].open();
});

/*=== Search ===*/
search_results = [];
var searchBar = app.searchbar.create({
	el: '.searchbar',
    searchContainer: '.list',
	searchIn: '.item-title',
	on: {
		search(sb, query, previousQuery) {
			console.log(query, previousQuery);
		}
	}
    
});





    
